{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/blogs/从getBoundingClientRect到Intersection Observer/",
    "result": {"data":{"site":{"siteMetadata":{"title":"张小伦的网络日志","description":"欢迎来到张小伦的网络日志 \n\t\t一个记录生活，分享心得的博客","menu":[{"id":"home","name":"首页","url":"/"},{"id":"category","name":"分类","url":"/categories"},{"id":"archive","name":"归档","url":"/archives"},{"id":"about","name":"关于我","url":"/about"}]}},"markdownRemark":{"id":"df83c933-57f4-54d5-a185-8aa110763e95","html":"<p>平时在写页面交互的时候经常使用兼容性不错的 getBoundindClientReact 方法，以快速获取元素大小和元素位置。最近无意中看到getBoundingClientRect方法会导致 Reflow的说法，但是并没有提及为什么，很是好奇，遂研究了一番。</p>\n<!-- more -->\n<p>我按照以下顺序，一一介绍相关内容</p>\n<ol>\n<li>常见的几种获取元素大小和位置的方法</li>\n<li>getBoundingClientRect()的用法</li>\n<li>Repaint 和 Reflow</li>\n<li>为什么 getBoundingClientRect() 会触发 Reflow</li>\n<li>使用IntersectionObserver监听元素位置</li>\n</ol>\n<h2>常见的几种获取元素大小和位置的方法</h2>\n<h3>获取元素大小</h3>\n<p>在DOM中提供了多个与元素宽高相关的方法，想要确认元素的宽高时有几种属性可以选择。</p>\n<h4><strong>offsetWidth和offsetHeight</strong></h4>\n<p>分别返回元素包含边框以内的宽和高</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e996fa32a4e72dfd40f6e5076405c788/c7a90/Xnip2020-05-23_22-35-05.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.51898734177216%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAEEAv/EABUBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAG3NChsGWf/xAAbEAACAQUAAAAAAAAAAAAAAAABAhMAEBESIf/aAAgBAQABBQIbMzhkWoewZt//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAcEAACAgMBAQAAAAAAAAAAAAABAgMRABAhIzH/2gAIAQEABj8Cf0YU1cyxI/0aJEjC+52Rzr//xAAbEAEBAQACAwAAAAAAAAAAAAABEQAQITFRsf/aAAgBAQABPyEVagETwaxpAjJ2z1hy+9egSZRAyjFJ84//2gAMAwEAAgADAAAAEG/P/8QAFhEAAwAAAAAAAAAAAAAAAAAAEDFB/9oACAEDAQE/EKx//8QAFxEAAwEAAAAAAAAAAAAAAAAAARARMf/aAAgBAgEBPxCCYv/EABoQAQACAwEAAAAAAAAAAAAAAAEAQREhMVH/2gAIAQEAAT8QZg1OQCWLbAjAztArmXH2aL1rkOMF2YwFmaLg8juwRE9dIGCf/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1\"\n        title=\"1\"\n        src=\"/static/e996fa32a4e72dfd40f6e5076405c788/828fb/Xnip2020-05-23_22-35-05.jpg\"\n        srcset=\"/static/e996fa32a4e72dfd40f6e5076405c788/ff44c/Xnip2020-05-23_22-35-05.jpg 158w,\n/static/e996fa32a4e72dfd40f6e5076405c788/a6688/Xnip2020-05-23_22-35-05.jpg 315w,\n/static/e996fa32a4e72dfd40f6e5076405c788/828fb/Xnip2020-05-23_22-35-05.jpg 630w,\n/static/e996fa32a4e72dfd40f6e5076405c788/0ede0/Xnip2020-05-23_22-35-05.jpg 945w,\n/static/e996fa32a4e72dfd40f6e5076405c788/3ac88/Xnip2020-05-23_22-35-05.jpg 1260w,\n/static/e996fa32a4e72dfd40f6e5076405c788/c7a90/Xnip2020-05-23_22-35-05.jpg 2056w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h4><strong>clientWidth和clientHeight</strong></h4>\n<p>分别返回元素包含内边距以内的宽和高</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6425644b152f8b0fbf9f3b31be7c4372/28062/Xnip2020-05-23_22-47-03.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70.25316455696203%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAEEA//EABUBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAGxbqG4Cz//xAAZEAACAwEAAAAAAAAAAAAAAAABAgASExD/2gAIAQEAAQUCFmL2RZiQcWbn/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFREBAQAAAAAAAAAAAAAAAAAAEEH/2gAIAQIBAT8Bh//EAB0QAAIBBAMAAAAAAAAAAAAAAAERAgADECEjMVH/2gAIAQEABj8CnySCktUxcl2MSVwhlqt3ZEeY/8QAGhABAQEBAAMAAAAAAAAAAAAAAREAIRBBgf/aAAgBAQABPyEvIkBEwI3yjJ1w5UH2ANIFgPB6+eP/2gAMAwEAAgADAAAAEMzP/8QAFxEAAwEAAAAAAAAAAAAAAAAAEBEhMf/aAAgBAwEBPxCvR//EABcRAAMBAAAAAAAAAAAAAAAAAAEQEUH/2gAIAQIBAT8Qgwv/xAAaEAEAAgMBAAAAAAAAAAAAAAABABEhMUFR/9oACAEBAAE/EAUptUAel9j1cUdwI6L7LDuMai9oMZbV5S+exDoNRiqzJbZ7Aon/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2\"\n        title=\"2\"\n        src=\"/static/6425644b152f8b0fbf9f3b31be7c4372/828fb/Xnip2020-05-23_22-47-03.jpg\"\n        srcset=\"/static/6425644b152f8b0fbf9f3b31be7c4372/ff44c/Xnip2020-05-23_22-47-03.jpg 158w,\n/static/6425644b152f8b0fbf9f3b31be7c4372/a6688/Xnip2020-05-23_22-47-03.jpg 315w,\n/static/6425644b152f8b0fbf9f3b31be7c4372/828fb/Xnip2020-05-23_22-47-03.jpg 630w,\n/static/6425644b152f8b0fbf9f3b31be7c4372/0ede0/Xnip2020-05-23_22-47-03.jpg 945w,\n/static/6425644b152f8b0fbf9f3b31be7c4372/3ac88/Xnip2020-05-23_22-47-03.jpg 1260w,\n/static/6425644b152f8b0fbf9f3b31be7c4372/28062/Xnip2020-05-23_22-47-03.jpg 2044w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h4><strong>scorllHeight</strong></h4>\n<p>分别返回元素内容的宽和高，包括由于溢出导致的视图中不可见内容。测量方式与clientWidth(clientHeight)相同，包含元素的内边距，但不包括边框，外边距或垂直滚动条</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/64b79265fa4bc21cb9ac8e292aa7ba9c/2b327/Xnip2020-05-23_23-06-40.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 89.24050632911393%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAASABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAIBBAX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAv/aAAwDAQACEAMQAAAB6duJeqKZIWD/xAAaEAACAwEBAAAAAAAAAAAAAAABAgADIRAS/9oACAEBAAEFAtY6lkepQ4QeoYOf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFREBAQAAAAAAAAAAAAAAAAAAESD/2gAIAQIBAT8BI//EAB8QAAEDAwUAAAAAAAAAAAAAAAECISIAEDEgMkFCUf/aAAgBAQAGPwJUl7jg0iS88m3Z3ZVAzb06f//EABoQAQADAQEBAAAAAAAAAAAAAAEAETEhQWH/2gAIAQEAAT8hBFyAoAl1KDRLL4/JccU+yw7B9BXLWGTDMQyf/9oADAMBAAIAAwAAABC8AED/xAAVEQEBAAAAAAAAAAAAAAAAAAABIP/aAAgBAwEBPxBWP//EABcRAQADAAAAAAAAAAAAAAAAAAERICH/2gAIAQIBAT8QBGlP/8QAGhABAQEBAQEBAAAAAAAAAAAAAREAMSFBYf/aAAgBAQABPxAuWQmDAkdQp+eC3I+mKvj3Mp1IAU+sM62ohRksfxc6E++4DQ3PcN//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"3\"\n        title=\"3\"\n        src=\"/static/64b79265fa4bc21cb9ac8e292aa7ba9c/828fb/Xnip2020-05-23_23-06-40.jpg\"\n        srcset=\"/static/64b79265fa4bc21cb9ac8e292aa7ba9c/ff44c/Xnip2020-05-23_23-06-40.jpg 158w,\n/static/64b79265fa4bc21cb9ac8e292aa7ba9c/a6688/Xnip2020-05-23_23-06-40.jpg 315w,\n/static/64b79265fa4bc21cb9ac8e292aa7ba9c/828fb/Xnip2020-05-23_23-06-40.jpg 630w,\n/static/64b79265fa4bc21cb9ac8e292aa7ba9c/0ede0/Xnip2020-05-23_23-06-40.jpg 945w,\n/static/64b79265fa4bc21cb9ac8e292aa7ba9c/3ac88/Xnip2020-05-23_23-06-40.jpg 1260w,\n/static/64b79265fa4bc21cb9ac8e292aa7ba9c/2b327/Xnip2020-05-23_23-06-40.jpg 2202w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>获取元素位置</h3>\n<p>在实际应用中，获取元素位置主要是：</p>\n<ol>\n<li>获取元素相对视图窗口(viewport)上右下左的具体数值</li>\n<li>获取元素相对父元素上右下左的具体数值</li>\n</ol>\n<p>这里将用到<code class=\"language-text\">offsetTop</code>、<code class=\"language-text\">offsetLeft</code> 和 <code class=\"language-text\">offsetParent</code> 三个属性</p>\n<p><code class=\"language-text\">offsetParent</code>返回一个指向最近的（指包含层级上的最近）包含该元素的定位元素或者最近的 table,td,th,body元素。当元素的 <code class=\"language-text\">style.display</code> 设置为 “none” 时，<code class=\"language-text\">offsetParent</code> 返回 <code class=\"language-text\">null</code>。如果元素没有设置了定位属性的父元素，也会返回 <code class=\"language-text\">null</code></p>\n<p><code class=\"language-text\">offsetTop/offsetLeft</code>用来获取当前元素（不包括上边框） 相对于 <code class=\"language-text\">offsetParent</code> 的位置。</p>\n<p>也就是说:</p>\n<ul>\n<li>如果所有祖先元素都是静态定位 <code class=\"language-text\">position:static;</code>（默认情况），<code class=\"language-text\">offsetTop</code> 表示与 <code class=\"language-text\">Document</code> 最上方的高度差（文档最上方可能已经滚出视口，这个高度可能大于视口高度）。</li>\n<li>如果存在绝对定位的祖先元素 <code class=\"language-text\">position:absolute/fixed</code>，<code class=\"language-text\">offsetTop</code> 就会相对于这个元素。</li>\n</ul>\n<p>因此为了获取相对于 <code class=\"language-text\">Document</code> 最上方的高度差，需要递归地调用：</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">function</span> <span class=\"token function\">getOffsetPosition</span><span class=\"token punctuation\">(</span>el<span class=\"token operator\">:</span>HTMLElement<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> el<span class=\"token punctuation\">.</span>offsetParent\n    <span class=\"token operator\">?</span> el<span class=\"token punctuation\">.</span>offsetTop <span class=\"token operator\">+</span> <span class=\"token function\">getOffsetTop</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">.</span>offsetParent<span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">:</span> el<span class=\"token punctuation\">.</span>offsetTop\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>按照上面的说法，使用offset三兄弟来获取元素到父元素的距离时，必须得实现将目标父元素设置为定位元素。</p>\n<p>如果想要获取任意两个元素之间的距离，该怎么办呢？这时候可以使用<code class=\"language-text\">getBoundingClientReact()</code>了</p>\n<h2>getBoundingClientRect()</h2>\n<p>该方法返回元素的大小和当前相对视窗(viewport)的位置，通常大家都用这个方法来判断元素是否出现在可视窗口中。</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> reactObject<span class=\"token operator\">:</span> DOMRect <span class=\"token operator\">=</span> $Element<span class=\"token punctuation\">.</span><span class=\"token function\">getBoudingClientRect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>举个例子</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>foo<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Hello World<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>调用id为foo的div的<code class=\"language-text\">getBoundingClientRect()</code>方法：</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\">document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBoundingClientRect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// =>  {</span>\n<span class=\"token comment\">//       top: Number,</span>\n<span class=\"token comment\">//       left: Number,</span>\n<span class=\"token comment\">//       right: Number,</span>\n<span class=\"token comment\">//       bottom: Number,</span>\n<span class=\"token comment\">//       x: Number,</span>\n<span class=\"token comment\">//       y: Number,</span>\n<span class=\"token comment\">//       width: Number,</span>\n<span class=\"token comment\">//       height: Number,</span>\n<span class=\"token comment\">//     }</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/662231386295b75c0fbff01bd90a13a6/3f513/Xnip2020-05-24_10-25-34.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.54430379746836%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3LAD/8QAFRABAQAAAAAAAAAAAAAAAAAAARD/2gAIAQEAAQUCL//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAABD/2gAIAQEABj8Cf//EABcQAAMBAAAAAAAAAAAAAAAAAAABEBH/2gAIAQEAAT8hQyf/2gAMAwEAAgADAAAAEIPP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGRABAAIDAAAAAAAAAAAAAAAAAQAREEHw/9oACAEBAAE/ECFEL1Kc4//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Xnip2020-05-24_10-25-34.jpg\"\n        title=\"Xnip2020-05-24_10-25-34.jpg\"\n        src=\"/static/662231386295b75c0fbff01bd90a13a6/828fb/Xnip2020-05-24_10-25-34.jpg\"\n        srcset=\"/static/662231386295b75c0fbff01bd90a13a6/ff44c/Xnip2020-05-24_10-25-34.jpg 158w,\n/static/662231386295b75c0fbff01bd90a13a6/a6688/Xnip2020-05-24_10-25-34.jpg 315w,\n/static/662231386295b75c0fbff01bd90a13a6/828fb/Xnip2020-05-24_10-25-34.jpg 630w,\n/static/662231386295b75c0fbff01bd90a13a6/0ede0/Xnip2020-05-24_10-25-34.jpg 945w,\n/static/662231386295b75c0fbff01bd90a13a6/3f513/Xnip2020-05-24_10-25-34.jpg 1096w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>每一个字段返回的意义如下图所示：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5e9fcfbd4b75a15e9715480809e3f957/6af66/getBoundingClientRect-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 141.13924050632912%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"getBoundingClientRect-1.png\"\n        title=\"getBoundingClientRect-1.png\"\n        src=\"/static/5e9fcfbd4b75a15e9715480809e3f957/f058b/getBoundingClientRect-1.png\"\n        srcset=\"/static/5e9fcfbd4b75a15e9715480809e3f957/c26ae/getBoundingClientRect-1.png 158w,\n/static/5e9fcfbd4b75a15e9715480809e3f957/6bdcf/getBoundingClientRect-1.png 315w,\n/static/5e9fcfbd4b75a15e9715480809e3f957/f058b/getBoundingClientRect-1.png 630w,\n/static/5e9fcfbd4b75a15e9715480809e3f957/6af66/getBoundingClientRect-1.png 640w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>因为<code class=\"language-text\">getBoundingClientRect</code>是相对viewport计算的，所以可以使用<code class=\"language-text\">window.scrollY</code>和<code class=\"language-text\">window.scrollX</code>和返回的<code class=\"language-text\">x</code>,<code class=\"language-text\">y</code>做计算，得出元素相对整个页面的距离。</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> offsetLeft <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>scrollX <span class=\"token operator\">+</span> $<span class=\"token number\">0.</span><span class=\"token function\">getBoundingClientRect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>left\n<span class=\"token keyword\">const</span> offsetTop <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>scrollY <span class=\"token operator\">+</span> $<span class=\"token number\">0.</span><span class=\"token function\">getBoundingClientRect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>top</code></pre></div>\n<p>可以使用这种方法来计算任意两个元素之间的记录，按照上述方式分别计算两个元素的结果再做差值即可</p>\n<h2>Repaint和Reflow</h2>\n<p>为什么要谈谈 Repaint 和 Reflow？如果搜索相关关键字，会发现几乎所有的将 Repaint 和 Reflow的文章，都会提到前面所提及的那些属性和方法，但没有明说到底是为什么。</p>\n<p>再说 Repaint 和 Reflow 之前先简单介绍一下浏览器如何渲染网页的。</p>\n<ol>\n<li>从服务器接受数据</li>\n<li>将文档解析成Tokens&#x3C;, TagName, Attribute, AttributeValue, >)</li>\n<li>将Tokens转换成Node节点</li>\n<li>利用Node节点生成DOM树</li>\n<li>解析CSS,创建CSSOM</li>\n<li>CSSOM和DOM树合并成一个RenderTree</li>\n</ol>\n<ul>\n<li>RenderTree只包含渲染网页所需的节点</li>\n<li>从DOM树的根节点开始，计算那些显示的元素和对应的计算属性。不显示的元素(meta, script, link标签和display: none)将会忽略</li>\n</ul>\n<ol start=\"7\">\n<li>Reflow：计算每一个可见元素的布局，精确的位置和大小(Layout tree)</li>\n<li>Repaint：将像素渲染到屏幕中</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/523e1ddab75f068dba44bfc41d2f1d8c/1ffbd/dom-tree.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.68354430379747%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABHUlEQVQY03WQW0vCAACF98eD/kJEhGAQ1Jt0MxIlDUEryTajB02nzevUOZ27tWv7QqEXo+/pnKdz+IQr8ZSD/B59XWbDcNnlsLBP5iVNGAf8YpoWX563zUmS8B/Cu9ag1M8zt+Z4tsdIH1Idl3mbi5i2Reh7lFsLUoUm6ZKMagaIlRGX5xK5TJP10mVQFJHOCnSyTwiaVEMp3hKs9O1CbK3p3WdR69XNFRzbpjUyeJTX1BWL6cqm97FAeh7TqKmsdBPlQeL16Ib2RQXBuMuhHqdwFAU7ijA6HUbpE7TrLK5lEQQBKydE1jwGSx8/SjB0j9nYYT5xiMIYsz9jWm+jtwYI4WyK35WJXJf4OyG0bQLlk1CdEEfRH0e7/nb7DxDEb/T3/781AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"dom-tree.png\"\n        title=\"dom-tree.png\"\n        src=\"/static/523e1ddab75f068dba44bfc41d2f1d8c/f058b/dom-tree.png\"\n        srcset=\"/static/523e1ddab75f068dba44bfc41d2f1d8c/c26ae/dom-tree.png 158w,\n/static/523e1ddab75f068dba44bfc41d2f1d8c/6bdcf/dom-tree.png 315w,\n/static/523e1ddab75f068dba44bfc41d2f1d8c/f058b/dom-tree.png 630w,\n/static/523e1ddab75f068dba44bfc41d2f1d8c/40601/dom-tree.png 945w,\n/static/523e1ddab75f068dba44bfc41d2f1d8c/78612/dom-tree.png 1260w,\n/static/523e1ddab75f068dba44bfc41d2f1d8c/1ffbd/dom-tree.png 2108w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>为什么 getBoundingClientRect() 会触发 Reflow</h2>\n<p><code class=\"language-text\">offsetTop</code>、<code class=\"language-text\">offsetLeft</code>和<code class=\"language-text\">getBoundingClientRect</code>皆需要重新计算元素在布局中的精确位置或者大小，这必然会触发Reflow。</p>\n<p>在 chromium 的源码中可以找到代码：</p>\n<p><strong>offsetTop/offsetLeft</strong></p>\n<p><a href=\"https://source.chromium.org/chromium/chromium/src/+/master:third_party/blink/renderer/core/frame/visual_viewport.cc;l=435-461;drc=a3c165458e524bdc55db15d2a5714bb9a0c69c70?originalUrl=https:%2F%2Fcs.chromium.org%2F\">source</a></p>\n<div class=\"gatsby-highlight\" data-language=\"c++\"><pre class=\"language-c++\"><code class=\"language-c++\">double VisualViewport::OffsetLeft() const {\n  if (!MainFrame())\n    return 0;\n\n  UpdateStyleAndLayout(DocumentUpdateReason::kJavaScript);\n\n  return VisibleRect().X() / MainFrame()-&gt;PageZoomFactor();\n}</code></pre></div>\n<p>其中<code class=\"language-text\">UpdateStyleAndLayout</code>方法调用之后将会触发LayoutTree的重新渲染，也就是我们说的Reflow</p>\n<p>再比如<code class=\"language-text\">element.innerText</code>中调用的<code class=\"language-text\">UpdateStyleAndLayoutForNode</code>，最后也是通过调用<code class=\"language-text\">UpdateStyleAndLayout</code>触发Reflow。<a href=\"https://source.chromium.org/chromium/chromium/src/+/master:third_party/blink/renderer/core/dom/document.cc;l=2786-2794;drc=7f2a66319b71e1cd3be556aeaa50cd18d1be70c1\">source</a></p>\n<div class=\"gatsby-highlight\" data-language=\"c++\"><pre class=\"language-c++\"><code class=\"language-c++\">String Element::innerText() {\n  // We need to update layout, since |ElementInnerTextCollector()| uses line\n  // boxes in the layout tree.\n  GetDocument().UpdateStyleAndLayoutForNode(this,\n                                            DocumentUpdateReason::kJavaScript);\n  return ElementInnerTextCollector().RunOn(*this);\n}\n\n// document.cc\nvoid Document::UpdateStyleAndLayoutForNode(const Node* node,\n                                           DocumentUpdateReason reason) {\n  DCHECK(node);\n  if (!node-&gt;InActiveDocument())\n    return;\n\n  DisplayLockUtilities::ScopedForcedUpdate scoped_update_forced(node);\n  UpdateStyleAndLayout(reason);\n}</code></pre></div>\n<p>搜索<code class=\"language-text\">getBoundingClientRect</code>可以在<code class=\"language-text\">rang.cc</code>中找到对应的代码 <a href=\"https://source.chromium.org/chromium/chromium/src/+/master:third_party/blink/renderer/core/dom/range.cc;l=1620-1622;drc=7f2a66319b71e1cd3be556aeaa50cd18d1be70c1;bpv=1;bpt=1?q=getBoundingClientRect&#x26;ss=chromium%2Fchromium%2Fsrc&#x26;originalUrl=https:%2F%2Fcs.chromium.org%2F\">source</a></p>\n<div class=\"gatsby-highlight\" data-language=\"c++\"><pre class=\"language-c++\"><code class=\"language-c++\">DOMRect* Range::getBoundingClientRect() const {\n  return DOMRect::FromFloatRect(BoundingRect());\n}</code></pre></div>\n<p><code class=\"language-text\">BoundingRect()</code>中调用了<code class=\"language-text\">UpdateStyleAndLayout()</code> <a href=\"https://source.chromium.org/chromium/chromium/src/+/master:third_party/blink/renderer/core/dom/range.cc;l=1732-1747;drc=7f2a66319b71e1cd3be556aeaa50cd18d1be70c1;bpv=1;bpt=1?q=getBoundingClientRect&#x26;ss=chromium%2Fchromium%2Fsrc&#x26;originalUrl=https:%2F%2Fcs.chromium.org%2F\">source</a></p>\n<div class=\"gatsby-highlight\" data-language=\"c++\"><pre class=\"language-c++\"><code class=\"language-c++\">FloatRect Range::BoundingRect() const {\n  owner_document_-&gt;UpdateStyleAndLayout(DocumentUpdateReason::kJavaScript);\n\n  Vector&lt;FloatQuad&gt; quads;\n  GetBorderAndTextQuads(quads);\n\n  FloatRect result;\n  for (const FloatQuad&amp; quad : quads)\n    result.Unite(quad.BoundingBox());  // Skips empty rects.\n\n  // If all rects are empty, return the first rect.\n  if (result.IsEmpty() &amp;&amp; !quads.IsEmpty())\n    return quads.front().BoundingBox();\n\n  return result;\n}</code></pre></div>\n<blockquote>\n<p>好吧 说了半天，都是因为代码就这么写的</p>\n</blockquote>\n<h2>Intersection Observer API</h2>\n<p>一直以来，检测元素的可视状态或者两个元素的相对可视状态都得使用前文中提到的几个属性，但是不幸的是，这些属性都会触发 Reflow。Reflow有GUI渲染线程管理，而GUI渲染线程与JS引擎线程互斥，在一定程度上来说容易拖慢网页的性能(抛开计量谈毒性都是耍流氓)。但是有些情况都需要能都检测到元素可视状态的变化，比如：</p>\n<ul>\n<li>当页面滚动时，懒加载图片或其他内容。</li>\n<li>实现“可无限滚动”网站，也就是当用户滚动网页时直接加载更多内容，无需翻页。</li>\n<li>为计算广告收益，检测其广告元素的曝光情况。</li>\n<li>根据用户是否已滚动到相应区域来灵活开始执行任务或动画。</li>\n</ul>\n<p>Intersection Observer API 会注册一个回调方法，每当期望被监视的元素进入或者退出另外一个元素的时候(或者浏览器的视口)该回调方法将会被执行，或者两个元素的交集部分大小发生变化的时候回调方法也会被执行。通过这种方式，网站将不需要为了监听两个元素的交集变化而在主线程(GUI渲染线程)里面做任何操作，并且浏览器可以帮助我们优化和管理两个元素的交集变化。</p>\n<p>通过 Intersection Observer API 获取到两个元素重叠部分的准确值(这可能也是他不需要重新计算的原因吧)。最常用的使用方式是：如果两个元素发生的交集部分在 N% 左右时，需要做处理一些事情(执行回调)”</p>\n<h3>创建一个 intersection observer</h3>\n<p>它的API非常简单。构造函数有两个参数。callback是触发时调用的回调函数，在目标(target)元素和根(root)元素的交集大小超过阈值(threshold)规定的大小时候被执行。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    root<span class=\"token operator\">:</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#scrollArea'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> \n    rootMargin<span class=\"token operator\">:</span> <span class=\"token string\">'0px'</span><span class=\"token punctuation\">,</span> \n    threshold<span class=\"token operator\">:</span> <span class=\"token number\">1.0</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">const</span> observer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IntersectionObserver</span><span class=\"token punctuation\">(</span>callback<span class=\"token punctuation\">,</span> option<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> target <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#listItem'</span><span class=\"token punctuation\">)</span>\n\nobserver<span class=\"token punctuation\">.</span><span class=\"token function\">observe</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span></code></pre></div>\n<h4><strong>Intersection observer options</strong></h4>\n<p>传递到IntersectionObserver()构造函数的 options 对象包含以下字段：</p>\n<ul>\n<li><strong>root</strong>\n<ul>\n<li>指定根(root)元素，用于检查目标的可见性。必须是目标元素的父级元素。</li>\n<li>如果未指定或者为null，则默认为浏览器视窗。</li>\n</ul>\n</li>\n<li><strong>rootMargin</strong>\n<ul>\n<li>根元素的外边距。类似于css中的 margin 属性，比如 “10px 20px 30px 40px” (top, right, bottom, left)。</li>\n<li>如果有指定root参数，则rootMargin也可以使用百分比来取值。该属性值是用作root元素和target发生交集时候的计算交集的区域范围，使用该属性可以控制root元素每一边的收缩或者扩张。</li>\n<li>默认值为0。</li>\n</ul>\n</li>\n<li><strong>threshold</strong>\n<ul>\n<li>可以是一个数字也可以是一个数字数组。目标元素和根元素相交程度达到该值的时候IntersectionObserver注册的回调函数将会被执行。</li>\n<li>如果你只是想要探测当target元素的在root元素中的可见性超过50%的时候，你可以指定该属性值为0.5。</li>\n<li>如果你想要target元素在root元素的可见程度每多25%就执行一次回调，那么你可以指定一个数组[0, 0.25, 0.5, 0.75, 1]。</li>\n<li>默认值是0(意味着只要有一个target像素出现在root元素中，回调函数将会被执行)。</li>\n<li>该值为1.0含义是当target完全出现在root元素中时候 回调才会被执行。</li>\n</ul>\n</li>\n</ul>\n<h4><strong>callback</strong></h4>\n<p>回调接收 IntersectionObserverEntry 对象和观察者的列表：</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">callback</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>entries<span class=\"token operator\">:</span> IntersectionObserverEntry<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> observer<span class=\"token operator\">:</span> IntersectionObserver<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> \n  entries<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>entry <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Each entry describes an intersection change for one observed</span>\n    <span class=\"token comment\">// target element:</span>\n    <span class=\"token comment\">//   entry.boundingClientRect</span>\n    <span class=\"token comment\">//   entry.intersectionRatio</span>\n    <span class=\"token comment\">//   entry.intersectionRect</span>\n    <span class=\"token comment\">//   entry.isIntersecting</span>\n    <span class=\"token comment\">//   entry.rootBounds</span>\n    <span class=\"token comment\">//   entry.target</span>\n    <span class=\"token comment\">//   entry.time</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">entries</code>是一个数组，和<code class=\"language-text\">threshold</code>对应。即使<code class=\"language-text\">threshold</code>输入的是一个数字，<code class=\"language-text\">entries</code>也会返回数组。下图是<code class=\"language-text\">IntersectionObserverEntry</code>的结构</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2d9e4db5e60c060aa6af53a7319481c0/8b936/intersection-observer-api.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 94.30379746835443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB+ElEQVQ4y5WSiWrrMBBF+//f1EKhpWtSCl0SQuImjndbix1ZkiWN5qGXkCZd6SAGC+nId+7MidY6jdN4FUfzKJq/LaKorKgxBoxBANQahditvkfn8CBOEFG1mswJWXeKaU4ZIQ2l1DCG1uJshhcXeHOD4zFeX+PrK6YpJgnGMcZxgMEAi9tsPRiDHwMg/A0AvQ/ZmKBlGLY5wG5wPGnLfFASED2A38bRKx+2e9neQZ30LQf8YwTYDqarlep0mZV5VmcJ7YXX0uHWMymDVVIGqX0fnJMSOUdrAyyZYgtGFoyu2WpVzKbFcl5t1gQZw+kURyO8uwv5/h6fnoJno1GwkNJdzfSNFYl2R8L9d6UeyQbjeNzm6aB62N//mvL+8GAH18uOM/dFk6x9b9Wn9/7LNratpOwGSjltqBDCK4VnZ/j8jC8vobzz81DweIyTCdb1ESyZJDNKYhZFRZFWIs+xafDyEh8e8PERr67CkJ2e4u1t+J5M9hICrDcDmZFs2RHSSdlLIUKTvEdKsShCV6QMzvf9V4ZZoCvelAZ+HZPPhjntyJI3lXH2+N6hT98ZBgAd0cZ4C866sP4wnqqTPBOiFs1yTctq0zShPVWFef47LLmkiSiTvlxzTtsNZy3nirHg088wAEiuFB9Ev2lobawZjLHWwo+DuYX/AZPsTBTZTNhlAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"intersection-observer-api.png\"\n        title=\"intersection-observer-api.png\"\n        src=\"/static/2d9e4db5e60c060aa6af53a7319481c0/f058b/intersection-observer-api.png\"\n        srcset=\"/static/2d9e4db5e60c060aa6af53a7319481c0/c26ae/intersection-observer-api.png 158w,\n/static/2d9e4db5e60c060aa6af53a7319481c0/6bdcf/intersection-observer-api.png 315w,\n/static/2d9e4db5e60c060aa6af53a7319481c0/f058b/intersection-observer-api.png 630w,\n/static/2d9e4db5e60c060aa6af53a7319481c0/40601/intersection-observer-api.png 945w,\n/static/2d9e4db5e60c060aa6af53a7319481c0/78612/intersection-observer-api.png 1260w,\n/static/2d9e4db5e60c060aa6af53a7319481c0/8b936/intersection-observer-api.png 1368w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p>注意：注册的回调函数将会在主线程中被执行。所以该函数执行速度要尽可能的快。</p>\n</blockquote>\n<h2>参考资料</h2>\n<ol>\n<li><a href=\"https://gist.github.com/paulirish/5d52fb081b3570c81e3a\">what-forces-layout.md</a></li>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/\">js-getboundingclientrect</a></li>\n<li><a href=\"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/render-tree-construction?hl=zh-cn\">渲染树构建、布局及绘制</a></li>\n<li><a href=\"https://gist.github.com/faressoft/36cdd64faae21ed22948b458e6bf04d5\">dom_performance_Reflow_repaint.md</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Intersection_Observer_API\">Intersection Observer API</a></li>\n</ol>","frontmatter":{"title":"从getBoundingClientRect到Intersection Observer","date":"May 23, 2019","description":null,"categories":[],"tags":[]}},"previous":{"fields":{"slug":"/blogs/MutationObserver、IntersectionObserver和ResizeObserver/"},"frontmatter":{"title":"IntersectionObserver、MutationObserver和ResizeObserver"}},"next":{"fields":{"slug":"/blogs/2019-03-09-浅谈-HTTP-缓存/"},"frontmatter":{"title":"浅谈 HTTP 缓存","draft":null,"tags":["HTTP"],"categories":["全栈"],"status":"publish"}}},"pageContext":{"id":"df83c933-57f4-54d5-a185-8aa110763e95","previousPostId":"3be25867-f9aa-547c-997a-4cf93622625c","nextPostId":"2f25d64b-dc5e-5051-80b1-6650d598731b"}},
    "staticQueryHashes": ["2841359383"]}