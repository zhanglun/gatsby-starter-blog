{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/blogs/2019-03-09-浅谈-HTTP-缓存/",
    "result": {"data":{"site":{"siteMetadata":{"title":"张小伦的网络日志","description":"欢迎来到张小伦的网络日志 \n\t\t一个记录生活，分享心得的博客","menu":[{"id":"home","name":"首页","url":"/"},{"id":"category","name":"分类","url":"/categories"},{"id":"archive","name":"归档","url":"/archives"},{"id":"about","name":"关于我","url":"/about"}]}},"markdownRemark":{"id":"2f25d64b-dc5e-5051-80b1-6650d598731b","html":"<p>说到缓存大家可能觉得很简单。“不就是检查资源是否有缓存，如果有就加以利用”，“可以节约服务器资源呗”。如果再深入一点，有的cache-control, last-modified, etag 之类的名词，但如果真的考究一下这些字段的细节，恐怕大多数人也说不清楚。遂做了一番整理，希望对大家有所帮助</p>\n<!--more-->\n<h2>HTTP 缓存</h2>\n<p>HTTP 缓存是一种保存资源副本并在下次请求时直接使用该副本的技术。最为常见的是，浏览器在本地缓存 HTML 页面、图片等静态资源文件静态文件。</p>\n<blockquote>\n<p>A HTTP cache is an information technology for the temporary storage (caching) of web documents, such as HTML pages and images, to reduce server lag. A web cache system stores copies of documents passing through it; subsequent requests may be satisfied from the cache if certain conditions are met. A web cache system can refer either to an appliance, or to a computer program.\n摘自 Wiki百科 <a href=\"https://www.wikiwand.com/en/Web_cache\">Web cache - Wikiwand</a></p>\n</blockquote>\n<p>合理利用缓存可以实现：</p>\n<ol>\n<li>减少冗余数据的传输，节约网络费用</li>\n<li>缓解了网络瓶颈的问题，节约带宽</li>\n<li>降低服务器压力，服务器可以更快的响应</li>\n<li>减少网络延迟，提升站点的访问速度</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 508px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cc0bd3461d2bf5d74d186b9346754f15/2fd48/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.79746835443038%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABzklEQVQoz31Sy47TQBD0RyNx5IYQH8Bt4cCNExJ7Qoq0HFbhwkIikjireMkmtuPHzPgdJ3HiQtXsRJFAjNSye7q7pqq7HWMMfN+H53lIkgRlWaJtW2y32/9aXddQSiGKIriui81mA2I5DBJwNBqhqipkWYaiKJDnuRj9S7P3cRwLIEGGwyG01nLvEMSe4/GIMAwlmYk0gtgvjYUEohLeXx5hSOo8fd9jv99LEYFpu91OWNtv0zTnGO2fgGeGfY9d2+KSMaWnSYLvd3fIjBFmp9PpHGfP2fvJZIIgCMR3mm17TuhOEElkxMHwn+V5tZW4HVjXdTgcDtKe2WyGwWCA1WolA3Li0Ed0/w2b2VeEv1wobaSQ0oMgROp76PQSZbyU3pI1Y2RDQD5Kn+zTNIXz+OMGyacXePzwHOGXt1iFMTKjpV9MuP/4Cj/fP4N//RLL+RhKczhGVocyF4sFptOpSOcDTuSNYW7fIRi8gRp/RpRoVE/S+Gpwc4Xl9WsUt1fwH1wUZSV9ZpwA6/Ua8/lcwLmLjlJ/AKoyh9L6r6FkRmFf52jrUh7gNthj18uuFn2naWrUTSMSCcZm2yLKMlz0skKeF9JbxmycLLl21uj/BtKHPafmUCEGAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"59818e08.png\"\n        title=\"59818e08.png\"\n        src=\"/static/cc0bd3461d2bf5d74d186b9346754f15/2fd48/1.png\"\n        srcset=\"/static/cc0bd3461d2bf5d74d186b9346754f15/c26ae/1.png 158w,\n/static/cc0bd3461d2bf5d74d186b9346754f15/6bdcf/1.png 315w,\n/static/cc0bd3461d2bf5d74d186b9346754f15/2fd48/1.png 508w\"\n        sizes=\"(max-width: 508px) 100vw, 508px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>如图所示HTTP缓存存在于浏览器和Web代理中。当然在服务器内部，也存在着各种缓存，比如本地缓存GuavaCache/Ehcache，分布式缓存Memcached/Redis等，但这不是本文要讨论的HTTP缓存。</p>\n<p><strong>为了方便描述，下文将用“缓存”代替“HTTP 缓存”</strong></p>\n<h2>缓存的分类</h2>\n<p>在我看来，无论按照什么场景或者维度来划分，HTTP缓存本质上就是两类：客户端缓存和服务端缓存。</p>\n<p>为什么这么说呢？因为在两台计算机之间使用HTTP协议通信时，在一条通信线路上，必定一端是客户端，一端是服务端。</p>\n<p>HTTP协议规定，请求从客户端发出，最后服务端响应。换言之，HTTP协议是能够明显区分哪一端是客户端，哪一段是服务端的。</p>\n<p>像 <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Caching_FAQ#%E5%90%84%E7%A7%8D%E7%B1%BB%E5%9E%8B%E7%9A%84%E7%BC%93%E5%AD%98\">MDN文章：HTTP 缓存 - HTTP | MDN</a> 中提到的私有缓存和共享缓存是从网络的拓扑结构层面来解释。</p>\n<p>至于网上大部分博文中提到的“强缓存”， “协商缓存”，我没有在任何文档中找到这两个关键词的定义，如果有知道的同学，欢迎留言。</p>\n<p>由于前端开发人员多与浏览器打交道，所以日常工作中大多时候会用 “浏览器缓存”来代替“客户端缓存”，这一点无伤大雅。</p>\n<h2>HTTP 的简单介绍</h2>\n<p>在具体解释HTTP首部字段对缓存的控制规则之前，简单介绍一些与 HTTP 协议有关的内容，作为后续内容的铺垫。</p>\n<h3>HTTP 协议</h3>\n<blockquote>\n<p>HTTP协议是 Hyper Text Transfer Protocol（超文本传输协议）的缩写,是用于从万维网（WWW:World Wide Web ）服务器传输超文本到客户端的传送协议。</p>\n</blockquote>\n<h3>HTTP 报文</h3>\n<p>HTTP 报文是HTTP协议传输的数据单元，即一次请求或者一次响应时，发送给对方的数据块。HTPP报文包含了将要发送的完整的数据信息。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a1c4fb0278b91555593ca4111766ee21/bb051/2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.810126582278485%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABQklEQVQoz31QW8uCUBD0//8FK4iwB7OoEH1IehApumA3NDLQikAxjbILvdjELhjxPXwLw549nJmzM4LjOFitVozZbIbFYgHXdfnseR622y3oTRAEuN1uuF6v3Avc73c8Hg9kWcZdmE6nGI/HME0T3W4Xuq6D7gaDAebzOfb7PQsfj0ecTqdvD8MQURQhSRKkacpzHMcQ2u02JEmCKIoolUool8uo1+uoVqvo9/sscDgcmEBbvF4vnM9nPJ9PnkmMtqaZSjAMA6qqotPpQFEUtFotaJqGZrOJ4XCIy+XCYrQp2SbQ7Ps+x0GfkW0SfL/fEHq9Hos1Gg1UKhXUajW2Lssyx7Db7ZhMRNqOSFR5njN+iwWXyyVvMhqNOLvJZMKwLAubzeabIYEyKoh/hYo7Af9UYY9yXK/XsG2bbf6KFELF+QMkn/giAtxpzwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"57450782.png\"\n        title=\"57450782.png\"\n        src=\"/static/a1c4fb0278b91555593ca4111766ee21/f058b/2.png\"\n        srcset=\"/static/a1c4fb0278b91555593ca4111766ee21/c26ae/2.png 158w,\n/static/a1c4fb0278b91555593ca4111766ee21/6bdcf/2.png 315w,\n/static/a1c4fb0278b91555593ca4111766ee21/f058b/2.png 630w,\n/static/a1c4fb0278b91555593ca4111766ee21/40601/2.png 945w,\n/static/a1c4fb0278b91555593ca4111766ee21/bb051/2.png 1212w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>HTTP 报文分为<strong>请求报文</strong>和<strong>响应报文</strong>。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d1a8fdbc16d69a472daa174b0f9c73f8/4d08a/3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.810126582278485%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABJ0lEQVQoz02R6a6CUAyEz/u/BD+MIXE3GlRccAV3g0oA8V3m5muCuT8mp03bmU6PW61WCoJA4/FYYRjqfD7rcrkYrter5eB+vxsej8cPz+dTr9dLt9tNs9lMp9NJbr1eGyFkkJIfj0dtNhuLkyTRdrvV4XAwYmq73c5yCMiJEWcJR7HX62mxWKjb7RopGAwGGg6Hmk6nFk8mE+tBKIoi4YxZCOM4/gk4iv1+35ohWC6Xtu18Pjfi/X5vjdjCXpZlhjzPVRSFPp+PyrK0OE1TOZjZADWscQtsciOG3u+3vfVQTUT+/X7tBVVVmaDDkud5arVa8n3/Z3U0GpkIFhFiU8QBFhHlpizAbLvdtr9w2Go0Gmo2m1bAPjcFxDXIO52Ooa797+Plzn9OwceVoWL1yAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2a108fe1.png\"\n        title=\"2a108fe1.png\"\n        src=\"/static/d1a8fdbc16d69a472daa174b0f9c73f8/f058b/3.png\"\n        srcset=\"/static/d1a8fdbc16d69a472daa174b0f9c73f8/c26ae/3.png 158w,\n/static/d1a8fdbc16d69a472daa174b0f9c73f8/6bdcf/3.png 315w,\n/static/d1a8fdbc16d69a472daa174b0f9c73f8/f058b/3.png 630w,\n/static/d1a8fdbc16d69a472daa174b0f9c73f8/4d08a/3.png 709w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9f360c29e6f47acdcf40fb50785b67ed/01267/4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.59493670886076%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABsElEQVQoz1WT16oCQRBE5/+fxRdFFHPOacWcEMwR86f05TT0ZX0oamemt6q6d9YNBgOZz+fS7/eVj8ej7Pd7ZXA4HOR8PsvlclHcbrcfPB4PWa/XMh6P5fl8iqtUKtLpdKTRaChjAIbDoZqwN51OZbPZ6IvGu91OjTFkvVqtdM/V63VpNptSKpWk2+3KbDZTsV6vJ5PJRBaLhSZfLpf6bGmv1+sP2DudTuLK5bKmy+VyKkhiEtICabbbrYI0wC9oLVv7KogAQu12WzzPk9FopMWv10uL7/e7MvNh7/1+y+fzke/3q8+IM2uMYJdKpSSfz2vLJMWAMZCQlo0ZhYER0D6zLRQK+n6xWNQzFwqFJBKJKJLJpKTTacEETiQSEo1GFfF4/N8YMCoz5xtUq1WdvaOYQzYoxAmwhzvs76DVauloGBGjYs1N4EaQ2oXDYYnFYpoAkBJggFitVlMxmESARBaCNUaIMwoXDAYlk8lodCvgZcDaWoJJA1gDkiFEOvtBXCAQ0ESk4Opks1ltFcaIdgFnjMLqqMEQYRLCfEDH4P1XB3DoTwPbmaWCAecEQgfBP8SO/uTn5RkVAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20394b00.png\"\n        title=\"20394b00.png\"\n        src=\"/static/9f360c29e6f47acdcf40fb50785b67ed/f058b/4.png\"\n        srcset=\"/static/9f360c29e6f47acdcf40fb50785b67ed/c26ae/4.png 158w,\n/static/9f360c29e6f47acdcf40fb50785b67ed/6bdcf/4.png 315w,\n/static/9f360c29e6f47acdcf40fb50785b67ed/f058b/4.png 630w,\n/static/9f360c29e6f47acdcf40fb50785b67ed/01267/4.png 713w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>请求报文和响应报文中必定包含 HTTP 首部，为客户端和服务端分别处理请求和响应提供所需要的信息。首部字段类型按照实际用途分为四种：</p>\n<ol>\n<li>通用首部字段 (General Heaer Fields) - 请求报文和响应报文双方都会使用的首部</li>\n<li>请求首部字段 (Request Header Fields) - 发送请求报文时使用的首部</li>\n<li>响应首部字段 (Resposne Header Fields) - 返回响应报文时使用的首部</li>\n<li>实体首部字段 (Entity Header Fields) - 报文实体部分使用的首部</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4676810d19234646bd9dc3cb6489543d/d67ca/5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.16455696202532%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB0UlEQVQoz01Sh6pqMRDM//+FvYu9i4qCvaFib2BBRRTFrsxjFnJ5geHsSTa7szNRy+US8/kcw+EQk8kEi8UC3GN8vV7xeDzwer1wOBwwnU4xm83kvN1uo16vSz7vE6vVCqrZbKJSqSASiSAcDqNWq6Hb7aJYLOJ+v0OvzWaDcrmMRqOBXC4Hl8slSCaTYA2C95TH44HBYIDZbIbNZoPdbgf3vF4vTqcTPp/PX0E2YcFoNAqLxQKn0wmfzydMNREVCoUQDAYlwWQySUymfr8ft9sN7/dbwJEHg4GMzXFTqRTi8Tiq1arIoKFisZjQ5peFmEik0+m/kanh5XKRf60p/3e7ncTcez6fQkDRDKLX66Hf72M8HgsLxjSFFzj28XiUfYIGkCV104aQHQ1S2i2OToZMYgPqxY567fd7GY8a5vN5uN1uOBwOJBIJudNqteSrqBUNoX5Wq1WEpuOBQADn8xnf71cKcrxSqSQFWYT5LEjzaAhBYoqHZGc0GsVtmkJN2Yg6aY3+N4Vuat21Kfotq0KhACKTySCbzcqo7EQ2dFcv7TaLkzUN2m63YoY2i5orCq7fGhM6nY40YHHqxj3GfMw8W6/XGI1GwpAxF+//fj/BP7IT/+BdI/jvAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"7c478d42.png\"\n        title=\"7c478d42.png\"\n        src=\"/static/4676810d19234646bd9dc3cb6489543d/f058b/5.png\"\n        srcset=\"/static/4676810d19234646bd9dc3cb6489543d/c26ae/5.png 158w,\n/static/4676810d19234646bd9dc3cb6489543d/6bdcf/5.png 315w,\n/static/4676810d19234646bd9dc3cb6489543d/f058b/5.png 630w,\n/static/4676810d19234646bd9dc3cb6489543d/d67ca/5.png 714w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>开发者工具中的 Network选项中，可以查看请求的具体信息\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d5274665bfce38ddb61b1bdbd5993694/0eb6d/6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 82.91139240506328%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAABfElEQVQ4y52S627jIBCFef/325+b1ImN8RUbzG0AnyqkrRJ1t6oz0idGoBkd5gz786ZQNwNEK9C2HZqGo6k5Wi7AuUBVXVDXvORSLlhXBec8vA//hFVvZ1x5jWmUmCcJpTSsddg2W05jbOF+Z0r+v2al4ak+4684YZEr5lliWVZotWFdNUKgJ4giiOjb/SOs4QOGTsJsFjEmxFtRjIjxXnwUVnUeV2Eheg+jApAy9n1/GTZOhGVL2HRE9hG3uD28GqzuA4bWIkv79PCywnny8NcVoVYIXIF6gz3lb81/rbATDqZaQEKDOo3QakRpkS0hbQF7zIeaMje5r+9+Fu15f+LICNilCxiFRdK+qCo4QjKhcNQg1s4Jc++RRgMaDaJ0haRDmeVhUxo+YzoJqMsE1yp4aUGbBxkPsqEseFn4r/Nn2Lnz4K2BvS6gXpddfOSwQjFEeO6Qeo/s0see3I3Bgym/nuGyRpAi5E9cQt7iPdcRu0/HXP4Q9GMcWex3DvE1O6W7dQ4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"a4104786.png\"\n        title=\"a4104786.png\"\n        src=\"/static/d5274665bfce38ddb61b1bdbd5993694/f058b/6.png\"\n        srcset=\"/static/d5274665bfce38ddb61b1bdbd5993694/c26ae/6.png 158w,\n/static/d5274665bfce38ddb61b1bdbd5993694/6bdcf/6.png 315w,\n/static/d5274665bfce38ddb61b1bdbd5993694/f058b/6.png 630w,\n/static/d5274665bfce38ddb61b1bdbd5993694/0eb6d/6.png 913w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>缓存的工作机制</h2>\n<p>对于一条GET请求的基本缓存处理过程包括七个步骤。</p>\n<ol>\n<li>发送 – 缓存从网络中读取即将的请求报文</li>\n<li>解析 – 缓存对报文进行解析，提取出URL和各种首部</li>\n<li>查询 – 缓存查看是否有本地副本可用，如果没有，就获取一份副本，并保存在本地</li>\n<li>新鲜度检测 – 缓存查看已缓存副本是否足够新鲜，如果不是，就询问服务器是否有任何更新</li>\n<li>创建响应 – 缓存会用新的首部和已缓存主体来构建一条响应报文</li>\n<li>返回 – 服务器通过网络将响应发回给客户端</li>\n</ol>\n<p>这里的缓存可以是本地客户端缓存，也可以是代理缓存之类的缓存服务器。服务器可能是源服务器也可能是缓存服务器、客户端可以能是浏览器也可能是缓存服务器</p>\n<h3>新鲜度检测和服务器再验证</h3>\n<p>什么是新鲜度检测？要知道，不是所有的缓存副本都与服务器上的文档一致。毕竟，不同场景下，文档都有其变化的原则。比如说，一份报告可能每个月更新一次，在线报纸每天都有新的内容，而金融类的数据可能每过几秒钟就发生变化，如果缓存总是提供老的数据，反而变得毫无用处。</p>\n<p>文档副本在被缓存的一段时间内，都认为文档是“新鲜的”，缓存可以在不联系服务器的情况下，直接提供文档的副本，在客户端的体现为:<code class=\"language-text\">from cache</code>。当缓存的保留的时间过长，超过了限值，就认为文档“过时了”。在使用这个文档之前，缓存需要与服务端确认，文档是否发生变化，而这就是服务端再验证。</p>\n<p>HTTP 提供称之为<code class=\"language-text\">文档过期(document expiration)</code> 和 <code class=\"language-text\">服务器再验证(server revalidation)</code>的机制。可以在不要求服务器记住哪些文档拥有缓存的情况下，还能够了保证缓存与服务器之间的充分一致，</p>\n<p>下图是一个GET请求的缓存流程图</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9e5694846c71c77ee5ec10277f629443/668c6/7.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.49367088607595%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB3klEQVQoz52TUW8SQRSF99f6C3zwQRNN+qC8mTSxMYKJCab1oRJCTZP6UIxlweKCtVqgBYy1ICJQujsLM7Ozn9kFQkiMTb3JmZ25mT1z75kz1jRQPHWybHx8zYaTwZU+UYRhGOOmYU20JFHaIlHa5qG9yXjqrRDeBDFhPCqXSdeB6TheBkHA/0REagVeF1Faw317C1F8wGTQ4tIVKKWQUiHVAhop5XK9MlfoqIhwXqF72eeqncfI8d9PJsQYE+3HzBHOK2I+1+GsKytULuI0i+usM23l0P6A8dijvF3lIH2I/bKMO5jpKn86iMo6ovoE1f+CNJqzD232kwX2UwWapW9YZjJENrbw7PtMTtJo8QvXnVBIH5JPFsinbEa9MdoE6F4J4SSYHj1G96toDI1ii3cpm/xzm7Nie9ayL8H3xbWi+1dQd1r8qPXw3VlODAUXtS7nJx28gcAiDAkCHYtuTCTsqg2ib6RfFJXcEblHe2TWdjne+xrnqjvHbN7O8OpOlkr2M9bix+hWrzOy91vQOe3Ra/YRo9kDECPBeb3L99oF3lAsCadSxlCRPdSqXRY5gyF6WQEGZXR8vW+aRe4dJLn7/hm5lr0kXLT2TwQmNn0EPTd/pdvgxafdGOVOnT+bjIxtutvhswAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"65a807b1.png\"\n        title=\"65a807b1.png\"\n        src=\"/static/9e5694846c71c77ee5ec10277f629443/f058b/7.png\"\n        srcset=\"/static/9e5694846c71c77ee5ec10277f629443/c26ae/7.png 158w,\n/static/9e5694846c71c77ee5ec10277f629443/6bdcf/7.png 315w,\n/static/9e5694846c71c77ee5ec10277f629443/f058b/7.png 630w,\n/static/9e5694846c71c77ee5ec10277f629443/40601/7.png 945w,\n/static/9e5694846c71c77ee5ec10277f629443/78612/7.png 1260w,\n/static/9e5694846c71c77ee5ec10277f629443/668c6/7.png 1692w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>接下来解释该图中几个关键点的具体工作机制。</p>\n<h4>文档过期</h4>\n<p>通过通用首部 <code class=\"language-text\">Cache-Control</code> 和 <code class=\"language-text\">Expires</code>，HTTP 让服务器对每个文档附加一个“过期时间”，这些首部表示在多长的时间内可以将这些内容视为新鲜的。就像是给食物加上过期时间一样。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/40e0e068bfa048ccb14eda7fe7dcc6be/d9199/8.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.53164556962025%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABV0lEQVQoz3WSiY6DMAxE+///uIGScCVAgSbcZFY2Wwqla8kyQfA8Y+cWhiGiKML9focQAl3X4RXee05QxTv8umzv/745xi2OY1ASNE1T5FqjaRosy/wGbBT4toU3Gt65c8MjkJRJKVnhSyk1CIIAj7rGNM9AEsOHAr4w8NN0cvAZO5BgSZqiKEvkec5VxjHqqgKaGn5dr6PYDlcgzVFJiR8hoJRCUZT4Fvs8D8Cr5ShiYCAEzzDNMrY6zzPGccQ4jZin6Svgq+WQZ6bYLi1EG4Nc53zeMuH6skwIvyycR9Uny3Vd88xIXZZlkErBOoeu6+Gcg7V2+5lAjwq+Ks/Ao0LaptYaxhhk+aaMqrUOwzBwdlSbBkhj4Nnud/KrZbrMtOEokjCmQFVVbD1OEp4pNYiUhM4yPNsWywfsopBgtFnaMFnr+57t9sPAZ3p+Wrvnuqz/XmoC/gIU/VGT10qXRgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"9ef1d5bc.png\"\n        title=\"9ef1d5bc.png\"\n        src=\"/static/40e0e068bfa048ccb14eda7fe7dcc6be/f058b/8.png\"\n        srcset=\"/static/40e0e068bfa048ccb14eda7fe7dcc6be/c26ae/8.png 158w,\n/static/40e0e068bfa048ccb14eda7fe7dcc6be/6bdcf/8.png 315w,\n/static/40e0e068bfa048ccb14eda7fe7dcc6be/f058b/8.png 630w,\n/static/40e0e068bfa048ccb14eda7fe7dcc6be/40601/8.png 945w,\n/static/40e0e068bfa048ccb14eda7fe7dcc6be/d9199/8.png 960w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><code class=\"language-text\">Expires</code> 和 <code class=\"language-text\">Cache-Control: max-age</code> 所做的事情本质上都是过期日期。但前者使用的是绝对时间，定义的是过期的时间，超过这个时间，文档将被视为“过时了”。后者使用的是相对时间，定义的是缓存的使用时间，从第一次生成文档到文档不再新鲜，无法使用位置的最大合法生存时间，单位为秒。</p>\n<p>比如你在2019年3月1日买了一瓶牛奶，<code class=\"language-text\">Expires</code> 告诉你在3月15日后过期，而<code class=\"language-text\">Cache-Control:max-age</code> 告诉你是1209600秒 (14 * 24 * 60 * 60) 后过期。</p>\n<p><strong><code class=\"language-text\">Expires</code> 是来自HTTP/1.0版本的首部，目前存在的意义主要是向下兼容。</strong></p>\n<h4>服务器再验证</h4>\n<p>当缓存的新鲜度不再，意味着到了核对的时间了，缓存需要询问服务器原始文档是否发生了变化。这个过程只有两种结果：</p>\n<ol>\n<li>内容发生了变化，缓存将会获取一份新的文档副本，代替原来的副本，然后文档发给客户端</li>\n<li>内容没有发生变化，缓存获取新的首部，首部中包含新的过期时间，然后更新缓存中的首部</li>\n</ol>\n<p>这种机制的好处在于：按需校验，在保证缓存自动更新的前提下还能够节约服务器资源。</p>\n<p>HTTP提供了一些特殊的条件首部，当一个GET请求在请求首部中带上条件首部时，只有当条件为True时，服务器才会返回对象。</p>\n<h5>If-Modified-Since: [Date]</h5>\n<p>如果再指定日期后文档被修改了，条件判定为 True，请求成功后，新的文档将会被缓存，新首部会包含一个新的过期日期。反之响应报文的状态码 <code class=\"language-text\">304 Not Mofified</code>，不返回文档的主体。</p>\n<p>与响应首部中的<code class=\"language-text\">Last-Modified</code>配合使用。文档请求成功返回时，服务器将文档的的最后修改日期以<code class=\"language-text\">Last-Modified</code>加在响应报文中。当缓存进行验证时，将用这个值作为<code class=\"language-text\">If-Modified-Since</code>首部的字段值：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">If-Modified-Since: &lt;cached last-modified date></code></pre></div>\n<p>如果此时文档内容被修改，修改日期就会有所不同，条件判定为True。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9a46e2fe4fb20e4d4d39107fc064f5ad/913a1/9.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 87.9746835443038%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAACPUlEQVQ4y4WTV2tyQRCG/c0SzL8RDCh6I4LeJHhhIgYRC2KLJabZa6KxxDbhGVhZNXzfwngO65nZt63jcDgIxdput7LZbOSvZb6za7/fa9l7Dntgs9mUfD4v7+/v0u/3ZTAYaH1/f8vPz48eaMr02AeyTgZ2Oh0dysC3tzetRqMh9XpdSqWSFAoFSaVSkkgkJJlMyuvrq+RyOVmtVsehDjNsPB7rAD6az+eyXC5lMplIr9fTQxiYTqfl4eFB7u7uJBwJi9frFZfLpSxY0Hfww6LR5/NpeTwerVAopM3xeFyl4LDZbCamJxaLidPp1N7jQNuQaDQq2WxW1uu1FItFqdVqWtVqVelCHzToy+CPjw+5v79XRkfKtqD26na7WsPhUAeAAo2NLOhqBl2YYuzf7XaK1MBHR5pAg9Ofn58yGo0UJXtEjB47Oicut9tteXl5ka+vL3WOgj6HmKZzROc5PaEMpaenJymXy/qEFvpBE70oHEdLaC8WC5lOp4ryIjb82Wq1tNgDFbTQDmOIDK6Gw2Hx+/1yc3MjgUBArq+vVeOL2EA3EolIMBjUD3niOgEmMqCCAYhMkDng6urq79hwtTj59vZWhz8+Pkomk9G4QBvkmEHYMQaa/Od2u/VS/Dc2lUpFdTRagpBhuI0U5m7/GRuzYZzkdHOXMQJ0PE02YcB9twN9YYr9B4Ofn58VJY2g5J09XCYFvNsDT3Job5p3XEcbbgramXcOIDKgx6B/DjzX09wecxt4op2t3zmgXxZqRkEIqL+jAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"209f1f80.png\"\n        title=\"209f1f80.png\"\n        src=\"/static/9a46e2fe4fb20e4d4d39107fc064f5ad/f058b/9.png\"\n        srcset=\"/static/9a46e2fe4fb20e4d4d39107fc064f5ad/c26ae/9.png 158w,\n/static/9a46e2fe4fb20e4d4d39107fc064f5ad/6bdcf/9.png 315w,\n/static/9a46e2fe4fb20e4d4d39107fc064f5ad/f058b/9.png 630w,\n/static/9a46e2fe4fb20e4d4d39107fc064f5ad/40601/9.png 945w,\n/static/9a46e2fe4fb20e4d4d39107fc064f5ad/78612/9.png 1260w,\n/static/9a46e2fe4fb20e4d4d39107fc064f5ad/913a1/9.png 1476w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>用 Node.js 来简单实现这个过程：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> http <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"url\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fs\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"path\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> mimeList <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  css<span class=\"token operator\">:</span> <span class=\"token string\">\"text/css\"</span><span class=\"token punctuation\">,</span>\n  gif<span class=\"token operator\">:</span> <span class=\"token string\">\"image/gif\"</span><span class=\"token punctuation\">,</span>\n  html<span class=\"token operator\">:</span> <span class=\"token string\">\"text/html\"</span><span class=\"token punctuation\">,</span>\n  ico<span class=\"token operator\">:</span> <span class=\"token string\">\"image/x-icon\"</span><span class=\"token punctuation\">,</span>\n  jpeg<span class=\"token operator\">:</span> <span class=\"token string\">\"image/jpeg\"</span><span class=\"token punctuation\">,</span>\n  jpg<span class=\"token operator\">:</span> <span class=\"token string\">\"image/jpeg\"</span><span class=\"token punctuation\">,</span>\n  js<span class=\"token operator\">:</span> <span class=\"token string\">\"text/javascript\"</span><span class=\"token punctuation\">,</span>\n  json<span class=\"token operator\">:</span> <span class=\"token string\">\"application/json\"</span><span class=\"token punctuation\">,</span>\n  pdf<span class=\"token operator\">:</span> <span class=\"token string\">\"application/pdf\"</span><span class=\"token punctuation\">,</span>\n  png<span class=\"token operator\">:</span> <span class=\"token string\">\"image/png\"</span><span class=\"token punctuation\">,</span>\n  svg<span class=\"token operator\">:</span> <span class=\"token string\">\"image/svg+xml\"</span><span class=\"token punctuation\">,</span>\n  swf<span class=\"token operator\">:</span> <span class=\"token string\">\"application/x-shockwave-flash\"</span><span class=\"token punctuation\">,</span>\n  tiff<span class=\"token operator\">:</span> <span class=\"token string\">\"image/tiff\"</span><span class=\"token punctuation\">,</span>\n  txt<span class=\"token operator\">:</span> <span class=\"token string\">\"text/plain\"</span><span class=\"token punctuation\">,</span>\n  wav<span class=\"token operator\">:</span> <span class=\"token string\">\"audio/x-wav\"</span><span class=\"token punctuation\">,</span>\n  wma<span class=\"token operator\">:</span> <span class=\"token string\">\"audio/x-ms-wma\"</span><span class=\"token punctuation\">,</span>\n  wmv<span class=\"token operator\">:</span> <span class=\"token string\">\"video/x-ms-wmv\"</span><span class=\"token punctuation\">,</span>\n  xml<span class=\"token operator\">:</span> <span class=\"token string\">\"text/xml\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> Expires <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  maxAge<span class=\"token operator\">:</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">24</span> <span class=\"token operator\">*</span> <span class=\"token number\">365</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> pathname <span class=\"token operator\">=</span> url<span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>pathname<span class=\"token punctuation\">;</span> <span class=\"token comment\">//解析路径</span>\n  <span class=\"token keyword\">const</span> resourcePath <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname <span class=\"token punctuation\">,</span> pathname<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> suffix <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">extname</span><span class=\"token punctuation\">(</span>pathname<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//获取后缀</span>\n  <span class=\"token keyword\">const</span> contentType <span class=\"token operator\">=</span> mimeList<span class=\"token punctuation\">[</span>suffix<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">.</span><span class=\"token function\">existsSync</span><span class=\"token punctuation\">(</span>resourcePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//判断资源是否存在，存在则读取</span>\n    fs<span class=\"token punctuation\">.</span><span class=\"token function\">stat</span><span class=\"token punctuation\">(</span>resourcePath<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> stat</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n      <span class=\"token comment\">// stat.mtime 返回 文件最后修改的时间</span>\n      <span class=\"token keyword\">const</span> lastModified <span class=\"token operator\">=</span> stat<span class=\"token punctuation\">.</span>mtime<span class=\"token punctuation\">.</span><span class=\"token function\">toUTCString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> ifModifiedSince <span class=\"token operator\">=</span> <span class=\"token string\">\"If-Modified-Since\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> expires <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      res<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Last-Modified\"</span><span class=\"token punctuation\">,</span> lastModified<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      res<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Content-Type\"</span><span class=\"token punctuation\">,</span> contentType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      res<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Expires\"</span><span class=\"token punctuation\">,</span> expires<span class=\"token punctuation\">.</span><span class=\"token function\">toUTCString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      res<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Cache-Control\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"max-age=\"</span> <span class=\"token operator\">+</span> Expires<span class=\"token punctuation\">.</span>maxAge<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      expires<span class=\"token punctuation\">.</span><span class=\"token function\">setTime</span><span class=\"token punctuation\">(</span>expires<span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> Expires<span class=\"token punctuation\">.</span>maxAge <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// 服务端的lastModified 与请求中携带的 “If-Modified-Since”的字段值对比</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">[</span>ifModifiedSince<span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;&amp;</span> lastModified <span class=\"token operator\">==</span> req<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">[</span>ifModifiedSince<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//实现304逻辑</span>\n        res<span class=\"token punctuation\">.</span><span class=\"token function\">writeHead</span><span class=\"token punctuation\">(</span><span class=\"token number\">304</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Not Modified\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// 注意：此处没有返回资源</span>\n        res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> resource <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">createReadStream</span><span class=\"token punctuation\">(</span>resourcePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        res<span class=\"token punctuation\">.</span><span class=\"token function\">writeHead</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Ok\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        resource<span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">writeHead</span><span class=\"token punctuation\">(</span><span class=\"token number\">404</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token string\">\"Content-Type\"</span><span class=\"token operator\">:</span> contentType <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"No Found\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nserver<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">8080</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Server Listen: http://localhost:8080\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ol>\n<li>在第一次请求时，因为本地没有缓存，node server 返回状态码 200和实体文件，响应首部增加 <code class=\"language-text\">Last-Modified</code></li>\n<li>command+R 刷新页面(此时浏览器会给请求加上一个Cache-Control: max-age=0)。在第二次请求时，请求报文增加 <code class=\"language-text\">If-Modified-Since</code>，值为第一次请求时返回的<code class=\"language-text\">Last-Modified</code>。因为文件的最后修改时间没有发生变化，server 返回 304。</li>\n<li>重新编辑资源文件，再次刷新访问，请求报文依旧增加 <code class=\"language-text\">If-Modified-Since</code>，值为第一次请求时返回的 <code class=\"language-text\">Last-Modified</code>。此时 server 判定缓存失效，返回状态码 200和资源内容</li>\n</ol>\n<h5>If-None-Match: [ETag]</h5>\n<p>有些情况下，仅使用最后修改时间来做验证是不够的：</p>\n<ul>\n<li>有时候文档被重写，内容没有变化，但是修改时间变化</li>\n<li>有时候文档修改的内容不重要，对使用也没有影响</li>\n<li>有的服务器无法准确判断最后修改时间</li>\n<li>有的场景下文档的数据需要精确亚秒级别，比如实时监控。而 Last-Modified 只能精确到秒</li>\n</ul>\n<p>为了解决这个问题，引入了ETag(实体标签)作为版本标识符。ETag 是根据资源本身的特征经过计算得到的一个值，用来标识一个资源。并不像 Last-Modified 那样直接依赖修改时间而是依赖资源，所以要更加可靠和灵活。ETag在响应返回的时候附加在报文中，当文档发生了修改之后，可以修改对应的ETag来表名这是一个新的版本。缓存可以通过<code class=\"language-text\">If-None-Match</code>的校验结果来判断使用缓存还是重新获取文档。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3af287e681685457d124639ed4f23eef/1134b/10.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.177215189873415%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABFElEQVQoz22R3aqCUBCFe/9X8N4X6E666KKgiwxEDAWxtChD0dLS8m8d1sDuHPEMDLNxO2u+tWc2DAMYbdsiiiLEcYymafB+vyWrqpK7/4K9ql/VmTpQxPd9OI4D13URBAEOhwNutxuKohgJMPu+Hwmr+hUkzeVyESJ+I1We5zidTtjv99jtdlgul5jP59B1HZqmiZssy/D5fH4F1YFCTFItFgtsNhtJ0zRh27bQH49HnM9noeag+/0uSXcTQtKkaSo/r1YrGIYhdb1eY7vdwrIshGGIsizFTdd1QsghdV1PBTnl+Xx+7dMmBUiSJInU6/UqScrH44HX6yUg6j1Hlv8GJ5KU78NGLoVVWeSd53mTjXPLPzZgEkFFo+t2AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"054048af.png\"\n        title=\"054048af.png\"\n        src=\"/static/3af287e681685457d124639ed4f23eef/f058b/10.png\"\n        srcset=\"/static/3af287e681685457d124639ed4f23eef/c26ae/10.png 158w,\n/static/3af287e681685457d124639ed4f23eef/6bdcf/10.png 315w,\n/static/3af287e681685457d124639ed4f23eef/f058b/10.png 630w,\n/static/3af287e681685457d124639ed4f23eef/40601/10.png 945w,\n/static/3af287e681685457d124639ed4f23eef/78612/10.png 1260w,\n/static/3af287e681685457d124639ed4f23eef/1134b/10.png 1470w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>ETag的生成规则没有严格规定包括，文档内容的hash值，对最后修改时间的hash值，甚至是约定的版本号。作为服务器再验证机制中的一环，有强弱之分</p>\n<p>强校验的ETag匹配要求两个资源内容的每个字节需完全相同，包括所有其他实体字段（如Content-Language）不发生变化。一个强校验ETag校验符的表示形式：“22FAA065-2664-4197-9C5E-C92EA03D0A16”。</p>\n<p>弱校验的ETag匹配要求两个资源在语义上相等，不需要每个字节相同。一个弱校验ETag校验符的表现形式：w/”22FAA065-2664-4197-9C5E-C92EA03D0A16”。</p>\n<p>同样用Node.js 来简单实现：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> pathname <span class=\"token operator\">=</span> url<span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>pathname<span class=\"token punctuation\">;</span> <span class=\"token comment\">//解析路径</span>\n  <span class=\"token keyword\">const</span> resourcePath <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> pathname<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> suffix <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">extname</span><span class=\"token punctuation\">(</span>pathname<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//获取后缀</span>\n  <span class=\"token keyword\">const</span> contentType <span class=\"token operator\">=</span> mimeList<span class=\"token punctuation\">[</span>suffix<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">.</span><span class=\"token function\">existsSync</span><span class=\"token punctuation\">(</span>resourcePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//判断资源是否存在，存在则读取</span>\n    fs<span class=\"token punctuation\">.</span><span class=\"token function\">stat</span><span class=\"token punctuation\">(</span>resourcePath<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> stat</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> resource <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span>resourcePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">let</span> hash <span class=\"token operator\">=</span> crypto<span class=\"token punctuation\">.</span><span class=\"token function\">createHash</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sha1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">let</span> tag <span class=\"token operator\">=</span> hash<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>resource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">digest</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"base64\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>tag<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      res<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ETag'</span><span class=\"token punctuation\">,</span> tag<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">[</span><span class=\"token string\">\"if-none-match\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> tag<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        res<span class=\"token punctuation\">.</span><span class=\"token function\">writeHead</span><span class=\"token punctuation\">(</span><span class=\"token number\">304</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      res<span class=\"token punctuation\">.</span><span class=\"token function\">writeHead</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span>resource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// res.writeHead(200, \"Ok\");</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">writeHead</span><span class=\"token punctuation\">(</span><span class=\"token number\">404</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token string\">\"Content-Type\"</span><span class=\"token operator\">:</span> contentType <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"No Found\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nserver<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">8080</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Server Listen: http://localhost:8080\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ol>\n<li>在第一次请求时，因为本地没有缓存，node server 返回状态码 200和实体文件，响应首部增加 <code class=\"language-text\">ETag</code></li>\n<li>command+R 刷新页面(此时浏览器会给请求加上一个Cache-Control: max-age=0)。在第二次请求时，请求报文增加 <code class=\"language-text\">If-None-Match</code>，值为第一次请求时返回的<code class=\"language-text\">ETag</code>。因为文件的内容没有发生变化，server 返回 304。</li>\n<li>重新编辑资源文件，再次刷新访问，请求报文依旧增加 <code class=\"language-text\">ETag</code>，值为第一次请求时返回的 <code class=\"language-text\">ETag</code>。此时server获取到的ETag值已经发生了变化，判定缓存失效，返回状态码 200和资源内容</li>\n</ol>\n<h5>If-Unmodified-Since: Date</h5>\n<p>类似于If-Modified-Since，意义相反。区别是当服务器资源条件不满足时，不是返回 304 Not Modified，而是返回 412 Precondition Failed。</p>\n<h5>If-Match: ETag</h5>\n<p>和If-None-Match 相反</p>\n<p>说了这么多，再回到之前 GET 请求的缓存流程，结合刚才的解释，可以重新绘制一个流程图：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c7af3968afa863754291287db3746718/6cb28/11.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.55696202531645%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACFUlEQVQ4y52T7UsUURTG/WfrL+hbXwqKosAvgoR/QAVqQkKEmpRZuqaZ0Qq+rW+o67obuzN7Z+499+UXc2fSdP3UgQMz5555eO7zPDN0ml4wsjrBy/os1luKCiH8Vxc11JWc93s1Fo/ruGp4vQIEf8tscLcAHUI1oT4GjSnyLMU6jw8e5z3WOawHB1gfcM7H8zgLxOdy5nDOlQwlT0j23qHPVwnBY63D5IJoi/cOl10gnU28KIwxeCc41cL2DvBWI2Kw1iJiK8BmjbT2EPV9GKeOOdxsMv1khqXXP/C6iVp7RjJ/h3zrFUbnyPka/W+P6X2+R74zjuQ9pCAhUgLiLdJtIOlp1MZZR5bkGGXiglG/0d0jQmWYN0kETRuzSHpWMvYesRXDuFT1beUkR6etKLgvPjxbQq09RdUeYHbHMaqDERvluAQUY9A6v4qML+GdapJvDNP/dBe9O0GWqWhGrrpkaTsa4QqzCgO9uwIsDqwdzGDBu986or2zgsvTMi4EtLFocdW+RytDr51ita2u7Ev7rwH6Mmcrb34x9Wiew59n8b1wU0Twzl2Guf5hm+nnc+ws7w8CDmhoLFma4e0VwM3a+3rIwotljtdPqitXLv0V/t8OBMTZS+bWWC4OOrT2O4guo7KxscXk5Bzb2wcVwxAiYPwzbnaVsULjAj7p9JkbXWRmZIFuO4mAbxtfuL88xseTdf4A1XTkpNKbS54AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"704be86d.png\"\n        title=\"704be86d.png\"\n        src=\"/static/c7af3968afa863754291287db3746718/f058b/11.png\"\n        srcset=\"/static/c7af3968afa863754291287db3746718/c26ae/11.png 158w,\n/static/c7af3968afa863754291287db3746718/6bdcf/11.png 315w,\n/static/c7af3968afa863754291287db3746718/f058b/11.png 630w,\n/static/c7af3968afa863754291287db3746718/40601/11.png 945w,\n/static/c7af3968afa863754291287db3746718/78612/11.png 1260w,\n/static/c7af3968afa863754291287db3746718/6cb28/11.png 2430w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>与缓存相关的首部</h3>\n<p>总结一下目前涉及到的一些与缓存相关的首部字段，方便大家理解和体会：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/12989c5f854e258b1a9d8cbc9bfaada2/71ba4/12.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.06329113924051%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABuklEQVQoz22TaarcMBCEfd+QG4TcJAfIz0B+BXKHECZhBmbxMuNVXiVblmWpQrefIW8YgZCNrdLXVa0AALz3L+fz0FpjsRZSSmRZhqqqIIRAURao6xrOOQT7xlcC1losy8LrOE1o2xZSKhY7Ho+I4xi38IY4iVlYzzOCZzE1TWj6HrMxMMZgmiZeh2FA07bouh5FWeJ8PiOKIuR5zoftYyP0Hm510HpGVlU4Xi5Q44TVWqzOMeE8z8iLAnGS4PF44BaG/Nx2HZNTuZvg7o8xWNf1XclER76RGG2iSaTjuFHTNzqMxPYqA6Lz1kIT0bqiEALnMIRUIyohcL1emSzNMhz+HPidhJ7HHmSAL1/hP3yC+/gZ7nCC8o69IoP7fkBZlqjrBuM4svGULBG+Gpvgr7/w339i/vYDJi2gV4t+GLg9KGESuj/unGxyT7hkmkpJdF0HpRT6vuf1nYcjgMV7lELgEkWctjEL/0wtEoYh0jRlwrqp0TQNJ8x9WGx9yISe0nEORs9sPvlIhpPR5q11hKh4E1FQUERN82XJ/9+KZbFIshy/TycOhUoSomYq6jkiHKRkK8xbVzzfrH+DQE24lFaLoAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"24cb815b.png\"\n        title=\"24cb815b.png\"\n        src=\"/static/12989c5f854e258b1a9d8cbc9bfaada2/f058b/12.png\"\n        srcset=\"/static/12989c5f854e258b1a9d8cbc9bfaada2/c26ae/12.png 158w,\n/static/12989c5f854e258b1a9d8cbc9bfaada2/6bdcf/12.png 315w,\n/static/12989c5f854e258b1a9d8cbc9bfaada2/f058b/12.png 630w,\n/static/12989c5f854e258b1a9d8cbc9bfaada2/40601/12.png 945w,\n/static/12989c5f854e258b1a9d8cbc9bfaada2/78612/12.png 1260w,\n/static/12989c5f854e258b1a9d8cbc9bfaada2/71ba4/12.png 1870w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>内容有些许枯燥，但还是希望能够帮助大家理解</p>\n<p><strong>参考资料</strong></p>\n<ol>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Caching_FAQ#%E5%90%84%E7%A7%8D%E7%B1%BB%E5%9E%8B%E7%9A%84%E7%BC%93%E5%AD%98\">HTTP 缓存 - HTTP | MDN</a></li>\n<li><a href=\"https://blog.fundebug.com/2019/01/08/browser-cache-mechanism/\">浏览器缓存机制 | Fundebug博客</a></li>\n<li><a href=\"https://swiftcachelite.swiftserve.com/different-types-of-caching-and-their-differences/\">Different Types of Caching and Their Differences - SwiftCache Lite</a></li>\n<li><a href=\"https://stackoverflow.com/questions/49547/how-to-control-web-page-caching-across-all-browsers\">http - How to control web page caching, across all browsers? - Stack Overflow</a></li>\n<li><a href=\"https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/http-caching\">HTTP Caching  |  Web Fundamentals  |  Google Developers</a></li>\n<li><a href=\"https://www.wikiwand.com/en/HTTP_ETag\">HTTP ETag - Wikiwand</a></li>\n</ol>","frontmatter":{"title":"浅谈 HTTP 缓存","date":"March 09, 2019","description":null,"categories":["全栈"],"tags":["HTTP"]}},"previous":{"fields":{"slug":"/blogs/从getBoundingClientRect到Intersection Observer/"},"frontmatter":{"title":"从getBoundingClientRect到Intersection Observer"}},"next":{"fields":{"slug":"/blogs/2019-01-26-巧用-webpack-loader-实现项目的定制化/"},"frontmatter":{"title":"巧用 webpack loader 实现项目的定制化","draft":null,"tags":["Webpack"],"categories":["技术应用"],"status":"publish"}}},"pageContext":{"id":"2f25d64b-dc5e-5051-80b1-6650d598731b","previousPostId":"df83c933-57f4-54d5-a185-8aa110763e95","nextPostId":"b448a0d9-ef80-57dc-ac0f-bc89aeacf5c5"}},
    "staticQueryHashes": ["2841359383"]}