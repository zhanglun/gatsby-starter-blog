{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/blogs/使用python抓取知乎日报的api数据/",
    "result": {"data":{"site":{"siteMetadata":{"title":"张小伦的网络日志","description":"欢迎来到张小伦的网络日志 \n\t\t一个记录生活，分享心得的博客","menu":[{"id":"home","name":"首页","url":"/"},{"id":"category","name":"分类","url":"/categories"},{"id":"archive","name":"归档","url":"/archives"},{"id":"about","name":"关于我","url":"/about"}]}},"markdownRemark":{"id":"a047a6f1-912c-5fb8-acb7-c32cf72349ed","html":"<p>使用 <code class=\"language-text\">urllib2</code> 抓取数据时，最简单的方法是：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">import urllib2, json\r\ndef getStartImage():\r\n    stream = urllib2.urlopen('http://news-at.zhihu.com/api/3/start-image/1080*1776')\r\n    start_image = json.load(stream)\r\n    start_image = json.dumps(start_image, encoding='utf-8')\r\n    return start_image</code></pre></div>\n<p>使用<code class=\"language-text\">urllib2.urlopen</code>打开参数中给出的url，返回一个 <code class=\"language-text\">instance</code>（匿名的object）。<br>\n因为这个链接本该返回的是json数据，所以可以用json库提供的<code class=\"language-text\">json.load</code>方法将对象实例解析成一个字典，直接return的话，返回的是一个字典转化成的字符串。使用<code class=\"language-text\">json.dumps()</code>将dict转换成一个json对象，参数中<code class=\"language-text\">encoding='utf-8'</code>，指定编码格式。</p>\n<!--![](http://ncuey-crispelite.stor.sinaapp.com/1413276441112.png) -->\n<p>但是这种方法往往会遇到 <code class=\"language-text\">HTTP Error: 403 Forbidden</code>，因为网站禁止爬虫抓去该网站的数据。可以在请求中添加 <code class=\"language-text\">http header</code>，伪装成一个浏览器发出的请求。这里需要用到 urllib2 提供的一个类<code class=\"language-text\">Reuqest</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">urllib2.Request(url[, data][, headers][, origin_req_host][, unverifiable])</code></pre></div>\n<p>这个类是一个url请求的抽象化,其具体的使用细节可以参照<a href=\"https://docs.python.org/2/library/urllib2.html\">这里</a>，在这里就不说了。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">import urllib2, json\r\n# 设置header\r\nheaders = {'User-Agent':'Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.1.6)Gecko/20091201 Firefox/3.5.6'}\r\n\r\ndef getStartImage():\r\n    req = urllib2.Request(url = 'http://news-at.zhihu.com/api/3/start-image/1080*1776', headers = headers)\r\n    stream = urllib2.urlopen(req)\r\n    start_image = json.load(stream)\r\n    start_image = json.dumps(start_image, encoding='utf-8')\r\n    return start_image</code></pre></div>","frontmatter":{"title":"使用python抓取知乎日报的API数据","date":"October 08, 2014","description":null,"categories":["Python"],"tags":["Python","笔记"]}},"previous":{"fields":{"slug":"/blogs/我的响应式web开发实践笔记-media queries 初探/"},"frontmatter":{"title":"我的响应式web开发实践笔记-Media Queries 初探"}},"next":{"fields":{"slug":"/blogs/css的盒模型回顾/"},"frontmatter":{"title":"CSS的盒模型-过去和将来","draft":null,"tags":["CSS","笔记"],"categories":["前端"],"status":"publish"}}},"pageContext":{"id":"a047a6f1-912c-5fb8-acb7-c32cf72349ed","previousPostId":"74838cde-8c82-51e6-a77e-f14d4764919c","nextPostId":"f2844821-8d0e-5bba-8bed-a1cd900ab39a"}},
    "staticQueryHashes": ["2841359383"]}